# -*- coding: utf-8 -*-
"""Proyecto_SIR_generalizado.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1VVUesvOmZBeoccIWKeaJ-By-KZXNZBYK

# Proyecto final: "SIR generalizado para modelo epidemiológico".
### Cristóbal Ramos Suzuki, Leila Reyes Giménez
##### Profesor: Joaquín Fontbona
##### Profesor Auxiliar: Pablo Zúñiga

## Modelo SIR generalizado mediante simulación de Cadenas de Markov
"""

import numpy as np
import random as random
import matplotlib.pyplot as plt

# Definimos la distribución exponencial:
def exp(lamda, N=1):
    u = np.random.uniform(0,1,N)
    exp = np.zeros(N)
    for i in range(N):
        exp[i] = -np.log(u[i])/lamda
    return exp

#Funciones para seleccionar a theta individuos según la distribución de theta.
def seleccionBin(P,parametro,K): 
    cantidad = np.random.binomial(K,parametro)
    if cantidad <= len(P):
        randomlist_bin = random.sample(P,cantidad)
        return randomlist_bin 
    else:
        return []

def seleccionPoiss(P,parametro): 
    cantidad = np.random.poisson(parametro)
    if cantidad <= len(P):
        randomlist_poiss = random.sample(P,cantidad)
        return randomlist_poiss
    else:
        return []

def SIR_Generalizado(N, deltat, T, p, pre_mu, pre_gamma, distr_theta, printear=False):

    #-----------------------PARÁMETROS--------------------#
    # Generales:
    mu = pre_mu*N   # tasa de reunion
    #-----------------------------------------------------#

    # Definimos la población (finita)
    P = []
    i_0 = int(0.01*N)
    for i in range(i_0):      # Estado inicial de población infectada
        P.append([i,'i'])
    for i in range(i_0,N):    # Estado inicial de población susceptible
        P.append([i, 's'])    
    
    # Definimos los conjuntos Suceptible, Infectado y Recuperado.
    # Sin pérdida de generalidad asumimos que primeros i_0 son poblacion infect inicial
    S = [P[i] for i in range(i_0,N)]
    I = [P[i] for i in range(i_0)]
    R = []

    # Creamos la cadena de markov que representará la proporción de la poblacion susceptible, infectada y recuperada del total.
    Ys = [len(S)/N]
    Yi = [len(I)/N]
    Yr = [len(R)/N]

    # Reloj exponencial para tasa de reunión:
    last_gath_time = 0
    gathering_time = exp(mu)[0]

    # Reloj exponencial para tasa de recuperación:
    gamma = pre_gamma*len(I)
    last_recup_time = 0
    recup_time = exp(gamma)[0]

    if printear == True:   # Para visualizar el estado inicial de la cadena.
        print("t = ", 0)
        print("len S_i = ", len(S))
        print("len I_i = ", len(I))
        print("len R_i = ", len(R)) 
        print("Estado inicial = ", [Ys[0], Yi[0], Yr[0]])
        print("--------------------")

    # Malla temporal en que simulamos la evolución de la cadena. 
    for t in np.arange(deltat,T,deltat):
        if (t - last_gath_time) < gathering_time:  # Aun no se genera una reunión.
            Ys.append(len(S)/N)
            Yi.append(len(I)/N)
            Yr.append(len(R)/N)            
        
        else:  # Creamos la reunión y actualizamos el estado de la cadena:
            last_gath_time += gathering_time # Actualizamos el tiempo de la última reunión .
            gathering_time = exp(mu)[0]      # Sampleamos el tiempo de la próxima reunión 
            
            # Generamos gathering M segun la distribución de theta:
            if distr_theta[0] == 'bin': M = seleccionBin(P,distr_theta[1],distr_theta[2])
            elif distr_theta[0] == 'poiss': M = seleccionPoiss(P,distr_theta[1])

            # Separamos a los individuas infectados y los susceptibles de la reunión:
            M_i = []
            M_s = []
            for ind in M:
                if ind[1] == "i":
                    M_i.append(ind)
                if ind[1] == "s":
                    M_s.append(ind)

            # Actualizamos a Infectadxs
            if len(M_s)>0:
                b = np.random.binomial(1,1-(1-p)**(len(M_i)), len(M_s))  # Sampleo de v.a. Bernoulli para idetificar nuevos infectados. 
                for j in range(len(M_s)):
                    if b[j] == 1:
                        i_infect = S.index(M_s[j])
                        S.pop(i_infect)              # Sacamos al nuevo infectado del cjto de susceptibles. 
                        new_infect = M_s[j]
                        new_infect[1] = "i"
                        I.append(new_infect)         # Agregamos al nuevo infectado al cjto de infectados. 

            #Actualizamos a Recuperadxs:
            gamma = pre_gamma*(len(I)) # Actualizamos el gamma según la cantidad de infectados actual. 
            recup_time = exp(gamma)[0] # Sampleamos el tiempo de recuperación. 
            if len(I)>0:
                recups = 0   # Contamos la cantidad de individuos que se recuperarán. 
                while ((t - last_recup_time) >= recup_time) and (recups < len(I)):  # Tiempo transcurrido supera al tiempo de recuperación. 
                    recups += 1
                    last_recup_time += recup_time
                    gamma = pre_gamma*(len(I)-recups) # Actualizamos el gamma según la cantidad de infectados actual.
                    recup_time = exp(gamma)[0]        # Sampleamos el próximo tiempo de recuperación.

                for i in range(recups):
                    r = I.pop(0)        # Removemos a los recuperados del cjto de infectados,
                    R.append(r)         # y los agregamos al cjto de recuperados. 

            # Registramos el estado de la cadena de Markov en el tiempo t:
            Ys.append(len(S)/N)   
            Yi.append(len(I)/N)
            Yr.append(len(R)/N)

    if printear == True:     # Para visualizar el estado final de la cadena.
        print("t_f = ", t)
        print("len S_f = ", len(S))
        print("len I_f = ", len(I))
        print("len R_f = ", len(R))
        print("Estado final = ", [Ys[-1], Yi[-1], Yr[-1]])
        print("--------------------")

    # Creamos malla temporal para graficar la cadena según los parámetros:
    ejeX = np.arange(0,T,deltat)

    return [Ys, Yi, Yr], ejeX

# Desde ahora consideraremos los siguientes valores de N y deltat
N = 10000
deltat = 0.0001

"""### Consideraremos dos distribuciones para $\Theta$, Binomial (A) y Poisson (B), con sus respectivos parámetros.

#### A) $ \Theta \sim Bin(K, k)$

##### 1. $K=20, k=0.1 \Longrightarrow \mathbb{E}(\Theta) = 2$
"""

# Parámetros distribucion de theta
Distr_bin1 = ["bin", 0.1, 20]

# Simulación CM
Z_bin1, ejeX = SIR_Generalizado(N, deltat, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin1)

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Binomial.')
plt.title('Con K = ' +str(Distr_bin1[2])+", k = "+str(Distr_bin1[1]) + ', N = '+str(N)+ ' y delta = '+ str(deltat) )
plt.plot(ejeX,Z_bin1[0], label = "Susceptible")
plt.plot(ejeX,Z_bin1[1], label = "Infectada")
plt.plot(ejeX,Z_bin1[2], label = "Recuperada")
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""##### 2) $K=20, k=0.2 \Longrightarrow \mathbb{E}(\Theta) = 4$ """

# Parámetros distribucion de theta
Distr_bin2 = ["bin", 0.2, 20]

# Simulación CM
Z_bin2, ejeX = SIR_Generalizado(N, deltat, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin2)

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Binomial.')
plt.title('Con K = ' +str(Distr_bin2[2])+", k = "+str(Distr_bin2[1]) + ', N = '+str(N)+ ' y delta = '+ str(deltat) )
plt.plot(ejeX,Z_bin2[0], label = "Susceptible")
plt.plot(ejeX,Z_bin2[1], label = "Infectada")
plt.plot(ejeX,Z_bin2[2], label = "Recuperada")
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""##### 3) $K=20, k=0.3 \Longrightarrow \mathbb{E}(\Theta) = 6$ """

# Parámetros distribucion de theta
Distr_bin3 = ["bin", 0.3, 20]

# Simulación CM
Z_bin3, ejeX = SIR_Generalizado(N, deltat, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin3)

plt.figure()
plt.suptitle("Modelo SIR con CM. Tamaño de reunión con distribución Binomial")
plt.title('Con K = ' +str(Distr_bin3[2])+", k = "+str(Distr_bin3[1]) + ', N = '+str(N)+ ' y delta = '+ str(deltat) )
plt.plot(ejeX,Z_bin3[0], label = "Susceptible")
plt.plot(ejeX,Z_bin3[1], label = "Infectada")
plt.plot(ejeX,Z_bin3[2], label = "Recuperada")
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""#### Comparación de distintos parámetros para distribución binomial."""

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunion con distribución Binomial para distintos parámetros')
plt.title('N = '+str(N)+ ' y delta = '+ str(deltat) )
plt.plot(ejeX,Z_bin1[1], label = "Infectada para E(θ)="+str(Distr_bin1[1]*Distr_bin1[2]))
plt.plot(ejeX,Z_bin2[1], label = "Infectada para E(θ)="+str(Distr_bin2[1]*Distr_bin2[2]))
plt.plot(ejeX,Z_bin3[1], label = "Infectada para E(θ)="+str(Distr_bin3[1]*Distr_bin3[2]))
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""#### B) $\Theta \sim Poiss(\lambda)$

#####  $ 1) $   $\lambda = 2 \Longrightarrow \mathbb{E}(\Theta) = 2$
"""

# Parámetros distribucion de theta
Distr_poiss1 = ["poiss", 2]

# Simulación CM
Z_poiss1, ejeX = SIR_Generalizado(N, deltat, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_poiss1)

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Poisson.')
plt.title('Con $\lambda$ = ' +str(Distr_poiss1[1]) + ', N = '+str(N)+ ' y delta = '+ str(deltat))
plt.plot(ejeX,Z_poiss1[0], label="Susceptible")
plt.plot(ejeX,Z_poiss1[1], label="Infectada")
plt.plot(ejeX,Z_poiss1[2], label="Recuperada")
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""##### $ 2) $   $\lambda = 4 \Longrightarrow \mathbb{E}(\Theta) = 4$"""

# Parámetros distribucion de theta
Distr_poiss2 = ["poiss", 4]

# Simulación CM
Z_poiss2, ejeX = SIR_Generalizado(N, deltat, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_poiss2)

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Poisson.')
plt.title('Con $\lambda$ = '+ str(Distr_poiss2[1]) + ', N = ' + str(N)+ ' y deltat = '+ str(deltat))
plt.plot(ejeX,Z_poiss2[0], label="Susceptible")
plt.plot(ejeX,Z_poiss2[1], label="Infectada")
plt.plot(ejeX,Z_poiss2[2], label="Recuperada")
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""##### $ 3) $   $\lambda = 6 \Longrightarrow \mathbb{E}(\Theta) = 6$"""

# Parámetros distribucion de theta
Distr_poiss3 = ["poiss", 6]

# Simulación CM
Z_poiss3, ejeX = SIR_Generalizado(N, deltat, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_poiss3)

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Poisson.')
plt.title('Con $\lambda$ = '+ str(Distr_poiss3[1]) + ', N = '+ str(N)+ ' y deltat = '+ str(deltat))
plt.plot(ejeX,Z_poiss3[0], label="Susceptible")
plt.plot(ejeX,Z_poiss3[1], label="Infectada")
plt.plot(ejeX,Z_poiss3[2], label="Recuperada")
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""#### Comparación de distintos parámetros para distribución Poisson"""

plt.figure()
plt.suptitle('Modelo SIR con CM. Tamaño de reunion con distribución Poisson para distintos parámetros.')
plt.title('Con N = '+str(N)+ ' y delta = '+ str(deltat))
plt.plot(ejeX,Z_poiss1[1], label = "Infectada para E(θ)="+str(Distr_poiss1[1]))
plt.plot(ejeX,Z_poiss2[1], label = "Infectada para E(θ)="+str(Distr_poiss2[1]))
plt.plot(ejeX,Z_poiss3[1], label = "Infectada para E(θ)="+str(Distr_poiss3[1]))
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""### Veamos ahora una gráfico del modelo SIR con $\theta \sim Poiss(\lambda)$ donde $\lambda = 4$, sólo considerando la curva de infectados, variando el tamaño de delta_t."""

# Grafiquemos para un N fijo y distintos valores de deltat
Nt = 4000
list_deltat = [0.01,0.05,0.003,0.007,0.0001]
Distr_poiss = ["poiss", 4]

# Simulación CM
plt.figure()
for i in list_deltat:
    Z_poiss, ejeX = SIR_Generalizado(Nt,i, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_poiss)
    plt.plot(ejeX,Z_poiss[1],label = 'deltat = '+ 
    str(i))
plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Poisson')
plt.title('Con N = '+ str(Nt)+ ' fijo y distintos valores deltat')
plt.xlabel('Tiempo')    
plt.ylabel('Población')
plt.legend()

"""## Sistema de Edo's para modelo SIR generalizado"""

import scipy as sc
from scipy.integrate import*

#Sistema de EDO's Binomial
def sistemaBin(sol,tiempo,u):
    #Parámetros
    mu = 0.5
    p = 0.2
    gamma = 0.1
    K_bin = 20
    k_bin = 0.2

    s = sol[0]
    i = sol[1]
    r = sol[2]
    aux1 = (-mu) * K_bin * k_bin * s * (1 - (1 - k_bin*p*i)**(K_bin-1))   # EDO s'
    aux2 = mu * K_bin * k_bin * s * (1 - (1 - k_bin*p*i)**(K_bin-1))  -  gamma * i  #EDO i'
    aux3 = gamma * i    #EDO r'
    aux4 = [aux1,aux2,aux3]
    return aux4

#Sistema de EDO's Poisson
def sistemaPoiss(sol,tiempo,u):
    #Parámetros
    mu = 0.5
    p = 0.2
    gamma = 0.1
    k_poiss = 4

    s = sol[0]
    i = sol[1]
    r = sol[2]
    aux1 = (-mu) * k_poiss * s * (1 - np.exp(-k_poiss*p*i))  # EDO s'
    aux2 = mu * k_poiss * s * (1 - np.exp(-k_poiss*p*i))  -  gamma * i  #EDO i'
    aux3 = gamma * i    #EDO r'
    aux4 = [aux1,aux2,aux3]
    return aux4

def Sol_edos(sistema, sist0, deltat, T):
    
    tiempo = np.linspace(0,T,int(T/deltat))

    u = np.zeros(len(tiempo))
    s = np.empty_like(tiempo)
    i = np.empty_like(tiempo)
    r = np.empty_like(tiempo)

    s[0] = sist0[0]
    i[0] = sist0[1]
    r[0] = sist0[2]

    for j in range(1,len(tiempo)):
        pasos = [tiempo[j-1],tiempo[j]]
        sol = sc.integrate.odeint(sistemaBin,sist0,pasos,args = (u[j],))
        s[j] = sol[1][0]
        i[j] = sol[1][1]
        r[j] = sol[1][2]
        sist0 = sol[1]

    return [s,i,r], tiempo

#Condiciones iniciales
s0 = 0.99
i0 = 0.01
r0 = 0
sist0 = [s0,i0,r0]

deltat = 0.0001
Sol_EDOs_bin, tiempo = Sol_edos(sistemaBin, sist0, deltat, T=100)

plt.figure()
plt.title('Modelo SIR con sistema de EDOs Binomial')
plt.plot(tiempo,Sol_EDOs_bin[0],label='Susceptibles')
plt.plot(tiempo,Sol_EDOs_bin[1],label='Infectados')
plt.plot(tiempo,Sol_EDOs_bin[2],label='Recuperados')
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

deltat = 0.0001
Sol_EDOs_poiss, tiempo = Sol_edos(sistemaPoiss, sist0, deltat, T=100)

plt.figure()
plt.title('Modelo SIR con sistema de EDOs Poisson')
plt.plot(tiempo,Sol_EDOs_poiss[0],label='Susceptibles')
plt.plot(tiempo,Sol_EDOs_poiss[1],label='Infectados')
plt.plot(tiempo,Sol_EDOs_poiss[2],label='Recuperados')
plt.xlabel('Tiempo')
plt.ylabel('Población')
plt.legend()

"""## Convergencia del proceso de Markov a la solución del sistema de EDO's.

##### Para $\Theta$ ~ Bin(20,0.2)
"""

# Utilizamos Distr_bin2 que tiene E(theta)=4
N_list = [100, 500, 1000, 5000, 10000, 50000]
deltat_list = [1/i for i in N_list]
ZBin_list = []
SolBin_list = []
tiempo_list = []

for i in range(len(N_list)):
    Z_bin_Ni, ejeX_Ni = SIR_Generalizado(N_list[i], deltat_list[i], T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin2)
    Sol_EDOs_bin_Ni, tiempo_Ni = Sol_edos(sistemaBin, sist0, deltat_list[i], T=100)
    ZBin_list.append(Z_bin_Ni)
    SolBin_list.append(Sol_EDOs_bin_Ni)
    tiempo_list.append(tiempo_Ni)

for i in range(len(N_list)):
    plt.figure()
    plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Binomial.')
    plt.title('Con K = ' +str(Distr_bin2[2])+", k = "+str(Distr_bin2[1]) + ', N = '+str(N_list[i])+ ' y delta = '+ str(deltat_list[i]))
    plt.plot(tiempo_list[i],ZBin_list[i][1], label = "Infectada MC")
    plt.plot(tiempo_list[i],SolBin_list[i][1],label='Infectados EDOs')
    plt.xlabel('Tiempo')
    plt.ylabel('Población')
    plt.legend()

"""##### Para $\Theta$ ~ Poiss(4)"""

# Utilizamos Distr_poiss2 que tiene E(theta)=4
N_list = [100, 500, 1000, 5000, 10000, 50000]
deltat_list = [1/i for i in N_list]
ZPoiss_list = []
SolPoiss_list = []
tiempo_list = []

for i in range(len(N_list)):
    Z_Poiss_Ni, ejeX_Ni = SIR_Generalizado(N_list[i], deltat_list[i], T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_poiss2)
    Sol_EDOs_Poiss_Ni, tiempo_Ni = Sol_edos(sistemaBin, sist0, deltat_list[i], T=100)
    ZPoiss_list.append(Z_Poiss_Ni)
    SolPoiss_list.append(Sol_EDOs_Poiss_Ni)
    tiempo_list.append(tiempo_Ni)

for i in range(len(N_list)):
    plt.figure()
    plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Poisson.')
    plt.title('Con k = '+str(Distr_poiss2[1]) + ', N = '+str(N_list[i])+ ' y delta = '+ str(deltat_list[i]))
    plt.plot(tiempo_list[i],ZPoiss_list[i][1], label = "Infectada MC")
    plt.plot(tiempo_list[i],SolPoiss_list[i][1],label='Infectados EDOs')
    plt.xlabel('Tiempo')
    plt.ylabel('Población')
    plt.legend()

"""### Veamos la convergencia de la cadena con $\Theta$~Bin(20,0.2), con deltat = cte.

##### deltat = 0.1
"""

# Utilizamos Distr_bin2 que tiene E(theta)=4
N_list = [100, 500, 1000, 5000, 10000]
deltat2 = 0.1
ZBin_list2 = []
SolBin_list2 = []
tiempo_list2 = []

for i in range(len(N_list)):
    Z_bin_Ni2, ejeX_Ni = SIR_Generalizado(N_list[i], deltat2, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin2)
    Sol_EDOs_bin_Ni2, tiempo_Ni = Sol_edos(sistemaBin, sist0, deltat2, T=100)
    ZBin_list2.append(Z_bin_Ni2)
    SolBin_list2.append(Sol_EDOs_bin_Ni2)
    tiempo_list2.append(tiempo_Ni)

for i in range(len(N_list)):
    plt.figure()
    plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Binomial.')
    plt.title('Con K = ' +str(Distr_bin2[2])+", k = "+str(Distr_bin2[1]) + ', N = '+str(N_list[i])+ ' y delta = '+ str(deltat2))
    plt.plot(tiempo_list2[i],ZBin_list2[i][1], label = "Infectada MC")
    plt.plot(tiempo_list2[i],SolBin_list2[i][1],label='Infectados EDOs')
    plt.xlabel('Tiempo')
    plt.ylabel('Población')
    plt.legend()

"""##### deltat=0.01"""

# Utilizamos Distr_bin2 que tiene E(theta)=4
N_list = [100, 500, 1000, 5000, 10000]
deltat3 = 0.01
ZBin_list3 = []
SolBin_list3 = []
tiempo_list3 = []

for i in range(len(N_list)):
    Z_bin_Ni3, ejeX_Ni = SIR_Generalizado(N_list[i], deltat3, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin2)
    Sol_EDOs_bin_Ni3, tiempo_Ni = Sol_edos(sistemaBin, sist0, deltat3, T=100)
    ZBin_list3.append(Z_bin_Ni3)
    SolBin_list3.append(Sol_EDOs_bin_Ni3)
    tiempo_list3.append(tiempo_Ni)

for i in range(len(N_list)):
    plt.figure()
    plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Binomial.')
    plt.title('Con K = ' +str(Distr_bin2[2])+", k = "+str(Distr_bin2[1]) + ', N = '+str(N_list[i])+ ' y delta = '+ str(deltat3))
    plt.plot(tiempo_list3[i],ZBin_list3[i][1], label = "Infectada MC")
    plt.plot(tiempo_list3[i],SolBin_list3[i][1],label='Infectados EDOs')
    plt.xlabel('Tiempo')
    plt.ylabel('Población')
    plt.legend()

"""##### deltat=0.001"""

# Utilizamos Distr_bin2 que tiene E(theta)=4
N_list = [100, 500, 1000, 5000, 10000]
deltat4 = 0.001
ZBin_list4 = []
SolBin_list4 = []
tiempo_list4 = []

for i in range(len(N_list)):
    Z_bin_Ni4, ejeX_Ni = SIR_Generalizado(N_list[i], deltat4, T=100, p=0.2, pre_mu=0.5, pre_gamma=0.1, distr_theta=Distr_bin2)
    Sol_EDOs_bin_Ni4, tiempo_Ni = Sol_edos(sistemaBin, sist0, deltat4, T=100)
    ZBin_list4.append(Z_bin_Ni4)
    SolBin_list4.append(Sol_EDOs_bin_Ni4)
    tiempo_list4.append(tiempo_Ni)

for i in range(len(N_list)):
    plt.figure()
    plt.suptitle('Modelo SIR con CM. Tamaño de reunión con distribución Binomial.')
    plt.title('Con K = ' +str(Distr_bin2[2])+", k = "+str(Distr_bin2[1]) + ', N = '+str(N_list[i])+ ' y delta = '+ str(deltat4))
    plt.plot(tiempo_list4[i],ZBin_list4[i][1], label = "Infectada MC")
    plt.plot(tiempo_list4[i],SolBin_list4[i][1],label='Infectados EDOs')
    plt.xlabel('Tiempo')
    plt.ylabel('Población')
    plt.legend()

"""<a style='text-decoration:none;line-height:16px;display:flex;color:#5B5B62;padding:10px;justify-content:end;' href='https://deepnote.com?utm_source=created-in-deepnote-cell&projectId=3bf1084f-5255-4722-acca-d7252f921381' target="_blank">
<img alt='Created in deepnote.com' style='display:inline;max-height:16px;margin:0px;margin-right:7.5px;' src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iODBweCIgaGVpZ2h0PSI4MHB4IiB2aWV3Qm94PSIwIDAgODAgODAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU0LjEgKDc2NDkwKSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT5Hcm91cCAzPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IkxhbmRpbmciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEyMzUuMDAwMDAwLCAtNzkuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSJHcm91cC0zIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMjM1LjAwMDAwMCwgNzkuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0iUGF0aC0yMCIgZmlsbD0iIzAyNjVCNCIgcG9pbnRzPSIyLjM3NjIzNzYyIDgwIDM4LjA0NzY2NjcgODAgNTcuODIxNzgyMiA3My44MDU3NTkyIDU3LjgyMTc4MjIgMzIuNzU5MjczOSAzOS4xNDAyMjc4IDMxLjY4MzE2ODMiPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0zNS4wMDc3MTgsODAgQzQyLjkwNjIwMDcsNzYuNDU0OTM1OCA0Ny41NjQ5MTY3LDcxLjU0MjI2NzEgNDguOTgzODY2LDY1LjI2MTk5MzkgQzUxLjExMjI4OTksNTUuODQxNTg0MiA0MS42NzcxNzk1LDQ5LjIxMjIyODQgMjUuNjIzOTg0Niw0OS4yMTIyMjg0IEMyNS40ODQ5Mjg5LDQ5LjEyNjg0NDggMjkuODI2MTI5Niw0My4yODM4MjQ4IDM4LjY0NzU4NjksMzEuNjgzMTY4MyBMNzIuODcxMjg3MSwzMi41NTQ0MjUgTDY1LjI4MDk3Myw2Ny42NzYzNDIxIEw1MS4xMTIyODk5LDc3LjM3NjE0NCBMMzUuMDA3NzE4LDgwIFoiIGlkPSJQYXRoLTIyIiBmaWxsPSIjMDAyODY4Ij48L3BhdGg+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMCwzNy43MzA0NDA1IEwyNy4xMTQ1MzcsMC4yNTcxMTE0MzYgQzYyLjM3MTUxMjMsLTEuOTkwNzE3MDEgODAsMTAuNTAwMzkyNyA4MCwzNy43MzA0NDA1IEM4MCw2NC45NjA0ODgyIDY0Ljc3NjUwMzgsNzkuMDUwMzQxNCAzNC4zMjk1MTEzLDgwIEM0Ny4wNTUzNDg5LDc3LjU2NzA4MDggNTMuNDE4MjY3Nyw3MC4zMTM2MTAzIDUzLjQxODI2NzcsNTguMjM5NTg4NSBDNTMuNDE4MjY3Nyw0MC4xMjg1NTU3IDM2LjMwMzk1NDQsMzcuNzMwNDQwNSAyNS4yMjc0MTcsMzcuNzMwNDQwNSBDMTcuODQzMDU4NiwzNy43MzA0NDA1IDkuNDMzOTE5NjYsMzcuNzMwNDQwNSAwLDM3LjczMDQ0MDUgWiIgaWQ9IlBhdGgtMTkiIGZpbGw9IiMzNzkzRUYiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+' > </img>
Created in <span style='font-weight:600;margin-left:4px;'>Deepnote</span></a>
"""